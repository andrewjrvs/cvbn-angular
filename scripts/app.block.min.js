+function(root){"use strict";var colors=[null,"#e72944","#1086ff","#35d440","purple","black","cyan","gray"];function Offset(x,y){x=x||0;y=y||0;this.x=x;this.y=y}function Block(shape){this.shape=shape;this.offset=new Offset}Block.prototype.rotate=function rotate(dir){var tmpPeice=null;for(var y=0;y<this.shape.length;++y){for(var x=0;x<y;++x){tmpPeice=this.shape[x][y];this.shape[x][y]=this.shape[y][x];this.shape[y][x]=tmpPeice}}if(dir>0){this.shape.forEach(function(row){row.reverse()})}else{this.shape.reverse()}};function createPeice(type){if(type==="T"){return[[0,0,0],[1,1,1],[0,1,0]]}else if(type==="O"){return[[2,2],[2,2]]}else if(type==="L"){return[[0,3,0],[0,3,0],[0,3,3]]}else if(type==="J"){return[[0,4,0],[0,4,0],[4,4,0]]}else if(type==="I"){return[[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]]}else if(type==="S"){return[[0,6,6],[6,6,0],[0,0,0]]}else if(type==="Z"){return[[7,7,0],[0,7,7],[0,0,0]]}}root.blockFactory={get:function(letter){return new Block(createPeice(letter))},randomBlock:function(){var peices="ILJOSZT";return new Block(createPeice(peices[peices.length*Math.random()|0]))},colors:colors,Offset:Offset}}(window);+function(root){"use strict";function Player(){this.shape=null;this.score=null;this.reset();return this}Player.prototype.reset=function(){this.shape=null;this.score=0;return this};Player.prototype.drop=function(reverse){if(reverse){this.shape.offset.y--}else{this.shape.offset.y++}};Player.prototype.move=function(dir){this.shape.offset.x+=dir};Player.prototype.rotate=function(dir){this.shape.rotate(dir)};root.playerFactory={new:function(){return new Player},Player:Player}}(window);+function(root,blockFactory){"use strict";function Board(canvas,x,y){this.el=null;this.arena=null;this.width=x;this.height=y;this.reset();this.canvas=canvas;this.context=this.canvas.getContext("2d");this.context.scale(18,18)}Board.prototype.reset=function(){this.arena=createMatrix(this.width,this.height)};Board.prototype.drawBoard=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.draw(this.arena,null,false)};Board.prototype.draw=function(shape,point,shadow){point=point||{x:0,y:0};point.x=point.x||0;point.y=point.y||0;shape=shape||[[]];var self=this;shape.forEach(function(row,y){row.forEach(function(value,x){if(value!==0){self.context.fillStyle=blockFactory.colors[value];self.context.fillRect(x+point.x,y+point.y,1,1);if(shadow){self.context.shadowColor="#999";self.context.shadowBlur=20;self.context.shadowOffsetX=15;self.context.shadowOffsetY=15}}})})};Board.prototype.arenaSweep=function(){var rowCount=1;var rtnPoints=0;outer:for(var y=this.arena.length-1;y>0;--y){for(var x=0;x<this.arena[y].length;++x){if(this.arena[y][x]===0){continue outer}}var row=this.arena.splice(y,1)[0].fill(0);this.arena.unshift(row);++y;rtnPoints+=rowCount*10;rowCount*=2}return rtnPoints};Board.prototype.checkForHit=function(shape){var m=shape.shape,o=shape.offset;for(var y=0;y<m.length;++y){for(var x=0;x<m[y].length;++x){if(m[y][x]!==0&&(!this.arena[y+o.y]||this.arena[y+o.y][x+o.x]!==0)){return true}}}return false};Board.prototype.merge=function(shape){var self=this;shape.shape.forEach(function(row,y){row.forEach(function(value,x){if(value!==0){self.arena[y+shape.offset.y][x+shape.offset.x]=value}})})};function createMatrix(w,h){var matrix=[];while(h--){matrix.push(new Array(w).fill(0))}return matrix}root.boardFactory={new:function(canvas,x,y){return new Board(canvas,x,y)},Board:Board}}(window,blockFactory);+function(root,playerFactory,boardFactory,blockFactory,document){"use strict";var settings={ListCount:5};function Game(canvas){this.board=null;this.player=null;this.highScore=null;this.newPeiceList=[];this.lastTime=0;this.dropCounter=0;this.dropInterval=1e3;this.canvas=canvas}Game.prototype.reset=function(){this.newPeiceList.length=0;populatePeiceList.call(this);this.player.reset();this.player.shape=this.newPeiceList.shift();this.player.shape.offset.x=8;this.board.reset();populatePeiceList.call(this)};Game.prototype.clearHighScore=function(){this.highScore=0};Game.prototype.start=function(){this.board=boardFactory.new(this.canvas,12,20);this.player=playerFactory.new();this.reset();console.log("end start")};Game.prototype.playerRotate=function playerRotate(dir){var offset=1;var pos=this.player.shape.offset.x;this.player.rotate(dir);while(this.board.checkForHit(this.player.shape)){this.player.move(offset);offset=-(offset+(offset>0?1:-1));if(offset>this.player.shape.shape[0].length){this.player.rotate(-dir);this.player.shape.offset.x=pos;return}}};Game.prototype.playerMove=function playerMove(dir){this.player.move(dir);if(this.board.checkForHit(this.player.shape)){this.player.move(-1*dir)}};Game.prototype.playerDrop=function playerDrop(){this.player.drop();if(this.board.checkForHit(this.player.shape)){this.player.drop(true);this.board.merge(this.player.shape);this.player.score=this.board.arenaSweep();if(this.player.score>this.highScore){this.highScore=this.player.score}this.player.shape=this.newPeiceList.shift();this.player.shape.offset.x=8;this.player.shape.offset.y=0;if(this.board.checkForHit(this.player.shape)){console.log("Game Over");this.reset()}populatePeiceList.call(this)}this.dropCounter=0};Game.prototype.update=function update(time){var deltaTime=time-this.lastTime;this.lastTime=time;this.dropCounter+=deltaTime;if(this.dropCounter>this.dropInterval){this.playerDrop()}this.board.drawBoard();this.board.draw(this.player.shape.shape,this.player.shape.offset,true)};function populatePeiceList(){for(var i=0,len=settings.ListCount-this.newPeiceList.length;i<len;i++){this.newPeiceList.push(blockFactory.randomBlock())}}root.gameFactory={new:function(canvas){return new Game(canvas)},Game:Game}}(window,playerFactory,boardFactory,blockFactory,document);if(!Array.prototype.fill){Array.prototype.fill=function(value){if(this==null){throw new TypeError("this is null or not defined")}var O=Object(this);var len=O.length>>>0;var start=arguments[1];var relativeStart=start>>0;var k=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len);var end=arguments[2];var relativeEnd=end===undefined?len:end>>0;var final=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);while(k<final){O[k]=value;k++}return O}}app.register("dropBlockModule",function(ng){return ng.core.NgModule({imports:[],declarations:[app.AppComponent],bootstrap:[app.AppComponent]}).Class({constructor:function(){}})});+function(root){var game=null;function start(){var gm=gameFactory.new(document.getElementById("dropBlock"));gm.start();update.call(gm,0);game=gm}root.blockDropStart=start;function update(time){this.update(time);requestAnimationFrame(update.bind(this))}document.addEventListener("keydown",function(event){if(event.keyCode===37){game.playerMove(-1)}else if(event.keyCode===39){game.playerMove(1)}else if(event.keyCode===40){game.playerDrop()}else if(event.keyCode===81){game.playerRotate(-1)}else if(event.keyCode===87){game.playerRotate(1)}})}(window);
//# sourceMappingURL=scripts/app.block.min.js.map